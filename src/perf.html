<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>Node editor</title>
    <meta
      name="description"
      content="A node editor with a lot of nodes and links to check performances"
    />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <style>
      html,
      body {
        height: 100%;
      }

      body {
        margin: 0;
      }

      w-node-editor {
        height: 100%;
      }
    </style>
  </head>
  <body>
    <w-node-editor></w-node-editor>

    <script async type="module" src="./components/index.js"></script>

    <script>
      const nodeCount = 500
      const linkCount = 500
      const outputCountByNode = 2
      const inputCountByNode = 2
      const xMax = 800
      const yMax = 300

      const nodeEditor = document.querySelector('w-node-editor')

      for (let nodeId = 0; nodeId < nodeCount; nodeId++) {
        addNode(nodeId)
      }
      for (let linkId = 0; linkId < linkCount; linkId++) {
        addLink()
      }

      function addNode(nodeId) {
        const node = document.createElement('w-node')
        node.id = nodeId
        node.setAttribute('x', Math.random() * xMax)
        node.setAttribute('y', Math.random() * yMax)
        for (let i = 0; i < outputCountByNode; i++) {
          addOutput(node, i)
        }
        for (let i = 0; i < inputCountByNode; i++) {
          addInput(node, i)
        }
        nodeEditor.appendChild(node)
      }

      function addOutput(node, nodeOutputId) {
        const output = document.createElement('w-output')
        output.id = `out-${node.id}-${nodeOutputId}`
        node.appendChild(output)
      }

      function addInput(node, nodeInputId) {
        const input = document.createElement('w-input')
        input.id = `in-${node.id}-${nodeInputId}`
        node.appendChild(input)
      }

      function addLink() {
        const link = document.createElement('w-link')
        const fromNode = ~~(Math.random() * nodeCount)
        const fromNodeOutput = ~~(Math.random() * outputCountByNode)
        const toNode = ~~(Math.random() * nodeCount)
        const toNodeInput = ~~(Math.random() * inputCountByNode)
        link.setAttribute('from', `out-${fromNode}-${fromNodeOutput}`)
        link.setAttribute('to', `in-${toNode}-${toNodeInput}`)
        nodeEditor.appendChild(link)
      }
    </script>
  </body>
</html>
